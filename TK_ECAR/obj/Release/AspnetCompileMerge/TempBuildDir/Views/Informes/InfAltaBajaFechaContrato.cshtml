@using resourceView = TK_ECAR.Content.resources
@using TK_ECAR.Framework
@using System.Configuration;

@*<script src='@Scripts.Url("~/bundles/choosenJqJs")'> </script>
<script src='@Scripts.Url("~/bundles/choosenAjaxJs")'> </script>*@

<script type="text/javascript">
    $.validator.setDefaults({ ignore: null }); //para validar campos ocultos
</script>

<section>
    <div class="row">
        <div class="col-sm-12">
            <div class="infoInformes">
                <h3>@resourceView.TK_ECAR_Resource.TitleInformeFlotaFechaContrato</h3>
                <p>@resourceView.TK_ECAR_Resource.TitleInformeFlotaFechaContratoInf</p>
            </div>
            <div style="float:left; margin: 6px; border-bottom: 1px solid #ddd;" class="col-sm-12" width="100%"></div>
        </div>
    </div>

    @using (Html.BeginForm("InfAltaBajaFechaContrato", "Informes", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "stripHtml('formInformeFlota')", id = "formInformeFlota" }))
    {
        @Html.Partial("_FilterInformeFlota")

        <div class="row" id="rowValidationSummary">
            <div class="form-group" id="divValidationSummary">
                <div class="col-lg-12">
                    @Html.Partial("_CustomValidationSummary", ViewData.ModelState)
                </div>
            </div>
        </div>

    }

</section>

<style>
    .export-btn {
        margin: 10px;
        padding: 5px;
    }
    .dataTables_wrapper table thead{
        display:none;
    }

    /*.table th, .table td { 
     border-top: none !important; 
    }*/



    /*.dataTables_paginate,*/  
    /*.dataTables_wrapper,  
    .dataTables_info, 
    .dataTables_length,
    .dataTables_filter, 
    .paginate_button {
        color: white !important;
    }

    .paginate_button,
    .paginate_button previous disabled, 
    .paginate_button next disabled,
    .paginate_button.disabled, 
    .paginate_button.disabled:hover, 
    .paginate_button.disabled:active {
        color: #dcdcdc !important;
    }
    
    table.dataTable.display tbody {
        color: black !important;
    }*/ 
</style>

@section Scripts {
    @*<link href="~/Content/styles/Site.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href='@Styles.Url("~/Content/dataTablecss")'>
    <link rel="stylesheet" type="text/css" href='@Styles.Url("~/Content/dataTablecssResponsive")'>*@

    <link rel="stylesheet" type="text/css" href='@Styles.Url("~/Content/choosenCSS")'>
    <script src='@Scripts.Url("~/bundles/choosenJqJs")'> </script>
    <script src='@Scripts.Url("~/bundles/choosenAjaxJs")'> </script>

    @*<script src='@Scripts.Url("~/bundles/datatable")'> </script>
    <script src='@Scripts.Url("~/bundles/dtresponsive")'> </script>

    <script src='@Scripts.Url("~/bundles/DataTablesButtonJs")'> </script>
    <script src='@Scripts.Url("~/bundles/DataTablesbuttonsFlashJs")'> </script>
    <script src='@Scripts.Url("~/bundles/DataTablesbuttonsHtml5Js")'> </script>
    <script src='@Scripts.Url("~/bundles/DataTablesjszipJs")'> </script>
    <script src='@Scripts.Url("~/bundles/DataTablesVfsFontsJs")'> </script>

    <script src="~/Content/scripts/Application/Global.js"></script>
    <script src="~/Content/scripts/Application/DataTableUtilities.js"></script>*@

    <script type="text/javascript" language="javascript">
        var uRl = '@Url.Action("InfAltaBajaFechaContrato", "Informes")';

        $(document).ready(function () {
            $("#formInformeFlota").submit(function (e) {
                e.preventDefault();
                LimpiaValidationSummary();

                var formData = new FormData(this);
                $.ajax({
                    type: "POST",
                    url: uRl,
                    dataType: 'json',
                    //async: false,
                    data: formData,
                    contentType: false,
                    processData: false,

                    success: function (data) {
                        if (data == 'OK') {
                            ajaxSuccessInfAltaBajaFechContrato();
                            DescargaInfAltaBajaFechContrato();
                        }
                        else if (data == 'EMPTY'){
                            ajaxSuccessEmptyInfAltaBajaFechContrato();
                        }
                        else {
                            ajaxErrorInfAltaBajaFechContrato(data.replace("ERROR", ""));
                        }
                    },
                    error: function (error) {
                        ajaxErrorInfAltaBajaFechContrato(error);
                    }
                });
            });
        });

        function DescargaInfAltaBajaFechContrato() {
            var uRLdownLoadArchivos = '@Html.Raw(@Url.Action("DescargaInformeAltaBajaFechaContrato", "Informes"))'; //DESCARGA LOS ARCHIVOS GUARDADOS EN EL SERVIDOR.
            window.location = uRLdownLoadArchivos;
        }


        function ajaxSuccessInfAltaBajaFechContrato() {
            notify('@resourceView.TK_ECAR_Resource.toastrInfGeneracionInformeCorrecta', 'i');
        }

        function ajaxErrorInfAltaBajaFechContrato(message) {
            notify('@resourceView.TK_ECAR_Resource.toastrInfGeneracionInformeError' + '<br />' + message, 'e');
        }

        function ajaxSuccessEmptyInfAltaBajaFechContrato() {
            notify('@resourceView.TK_ECAR_Resource.toastrInfGeneracionInformeEmpty', 'w');
        }

    </script>
}
