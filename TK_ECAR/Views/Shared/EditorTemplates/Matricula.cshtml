@*@Html.TextBox("", ViewData.TemplateInfo.FormattedModelValue.ToString(), new { @class = "form-control" })*@
@*@Html.ListBox("", new List<SelectListItem>(), new { @class = "form-control"  })*@
@using resourceView = TK_ECAR.Content.resources.TK_ECAR_Resource

@{
    var vehiculosDeBaja = "0";
    if (ViewData["MatriculasDeBaja"] != null)
    {
        vehiculosDeBaja = (Convert.ToBoolean(ViewData["MatriculasDeBaja"].ToString()) ? "-1" : "0");
    }

}

@Html.Hidden(ViewData.TemplateInfo.FormattedModelValue.ToString())
<select id="miMatricula" title="Seleccionar una matrícula" search class="form-control">
    <option></option>
</select> 
<style type="text/css">
    #miMatricula_chosen {
        width: 100% !important;
        display: block;
    }
</style>
 <script type="text/javascript">
     //https://github.com/meltingice/ajax-chosen

     var urlMatriculas = '@Url.Action("GetMatriculas", "Home", new { matriculasDeBaja = "vermatriculasdadasdebaja" })';
     urlMatriculas = urlMatriculas.replace("vermatriculasdadasdebaja", @vehiculosDeBaja);
     $('#miMatricula').prepend($('<option></option>').html('@resourceView.msgCargando'));
     $("#miMatricula").ajaxChosen({
         type: 'GET',
         url: urlMatriculas,
         async: true,
         beforeSend: function (data, textStatus, jqXHR) {
             $("#miMatricula_chosen span").addClass('loading-Chosen')
         },
         complete: function (data, textStatus, jqXHR) {
             $("#miMatricula_chosen span").removeClass('loading-Chosen');
         },
         minTermLength: 0,
         dataType: 'json'
     }, function (data) {
         //var terms = [];
         var results = [];
         $.each(data, function (i, val) {
            // terms[i] = val;
             results.push({ value: val, text: val });
         });
         return results;

     },
     {
            //options
         disable_search_threshold: -1,
       //  loadingImg: "../Content/img/app/loading.gif"
     });


     $('#miMatricula').on('change', function () {
         $('#Matricula').val(this.value);
     });
</script>